<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PKMN Matrix Tabs</title>
    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #38bdf8;
            --normal: #A8A77A; --feuer: #EE8130; --wasser: #6390F0; --elektro: #F7D02C;
            --pflanze: #7AC74C; --eis: #96D9D2; --kampf: #C22E28; --gift: #A33EA1;
            --boden: #E2BF65; --flug: #A98FF3; --psycho: #F95587; --kaefer: #A6B91A;
            --gestein: #B6A136; --geist: #735797; --drache: #6F35FC; --stahl: #B7B7CE;
            --unlicht: #705746; --fee: #D685AD;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        
        /* Header & Tabs */
        .header { width: 100%; max-width: 500px; display: flex; gap: 10px; margin-bottom: 10px; }
        .mode-btn { 
            flex: 1; padding: 12px; border-radius: 12px; background: var(--card); 
            border: 2px solid transparent; cursor: pointer; font-size: 20px; text-align: center; transition: 0.2s;
        }
        .mode-btn.active { border-color: var(--accent); background: #334155; }

        .mode-content { width: 100%; max-width: 500px; display: flex; flex-direction: column; align-items: center; }
        .label { width: 100%; font-size: 11px; font-weight: bold; color: var(--accent); margin: 15px 0 5px 5px; text-transform: uppercase; }
        
        /* Grids */
        .grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; width: 100%; background: var(--card); padding: 8px; border-radius: 12px; }
        .icon { 
            width: 100%; height: 100%; aspect-ratio: 1.2; border-radius: 6px; display: flex; align-items: center; justify-content: center;
            font-size: 9px; font-weight: bold; color: white; cursor: pointer; border: 2px solid transparent; 
            text-shadow: 1px 1px 2px black; opacity: 0.4; transition: 0.15s ease-in-out;
        }
        
        /* NEU: Visuelles Feedback ohne Layout-Shift */
        .icon.selected { 
            opacity: 1; 
            border-color: white; 
            filter: brightness(1.15); 
            box-shadow: inset 0 0 8px rgba(255, 255, 255, 0.4), 0 2px 4px rgba(0,0,0,0.5); 
        }

        /* Ergebnisfelder */
        .box { width: 100%; background: var(--card); border-radius: 12px; padding: 12px; margin-top: 5px; }
        .row { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
        .symbol { font-size: 16px; min-width: 25px; }

        .badge {
            position: relative; width: 48px; height: 28px; border-radius: 4px; display: flex; 
            align-items: center; justify-content: center; font-size: 9px; font-weight: bold; color: white;
            text-shadow: 1px 1px 2px black;
        }
        .mult {
            position: absolute; top: -6px; right: -5px; background: black; border: 1px solid white;
            padding: 1px 3px; border-radius: 4px; font-size: 9px;
        }

        /* Matchup Card */
        .matchup-card {
            width: 100%; margin: 15px 0; padding: 15px;
            background: linear-gradient(145deg, #1e293b, #334155);
            border-radius: 16px; border: 2px solid var(--accent); text-align: center;
        }
        .result-badge { display: inline-block; padding: 8px 20px; border-radius: 10px; font-weight: 900; border: 2px solid white; margin-top: 10px; }

        /* Utility */
        .hidden { display: none !important; }
        .normal { background: var(--normal); } .feuer { background: var(--feuer); } .wasser { background: var(--wasser); } .elektro { background: var(--elektro); }
        .pflanze { background: var(--pflanze); } .eis { background: var(--eis); } .kampf { background: var(--kampf); } .gift { background: var(--gift); }
        .boden { background: var(--boden); } .flug { background: var(--flug); } .psycho { background: var(--psycho); } .kaefer { background: var(--kaefer); }
        .gestein { background: var(--gestein); } .geist { background: var(--geist); } .drache { background: var(--drache); } .stahl { background: var(--stahl); }
        .unlicht { background: var(--unlicht); } .fee { background: var(--fee); }
    </style>
</head>
<body>

    <div class="header">
        <div class="mode-btn active" id="btn-atk" onclick="setMode('attack')">‚öîÔ∏è</div>
        <div class="mode-btn" id="btn-def" onclick="setMode('defense')">üõ°Ô∏è</div>
    </div>

    <div id="view-attack" class="mode-content">
        <div class="label">1. Deine Attacke</div>
        <div class="grid" id="atkPicker"></div>

        <div class="label">Allgemeine Wirkung</div>
        <div class="box" id="atkStats"></div>

        <div class="label">2. Ziel (Pok√©mon Typen)</div>
        <div class="grid" id="targetPicker"></div>

        <div class="matchup-card" id="matchupArea">
            <div id="matchupVs" style="display:flex; justify-content:center; align-items:center; gap:10px;"></div>
            <div id="matchupVal"></div>
        </div>
    </div>

    <div id="view-defense" class="mode-content hidden">
        <div class="label">Dein Pok√©mon (1-2 Typen)</div>
        <div class="grid" id="defPicker"></div>

        <div class="label">Deine Resistenzen & Schw√§chen</div>
        <div class="box" id="defStats"></div>
    </div>

    <script>
        const types = ["normal", "feuer", "wasser", "elektro", "pflanze", "eis", "kampf", "gift", "boden", "flug", "psycho", "kaefer", "gestein", "geist", "drache", "stahl", "unlicht", "fee"];
        const labels = { normal: "NORM", feuer: "FEU", wasser: "WAS", elektro: "ELEK", pflanze: "PFL", eis: "EIS", kampf: "KMPF", gift: "GIFT", boden: "BOD", flug: "FLUG", psycho: "PSY", kaefer: "K√ÑF", gestein: "GEST", geist: "GEI", drache: "DRA", stahl: "STAH", unlicht: "UNL", fee: "FEE" };
        
        const chart = {
            normal: {gestein: .5, geist: 0, stahl: .5},
            feuer: {feuer: .5, wasser: .5, pflanze: 2, eis: 2, kaefer: 2, gestein: .5, drache: .5, stahl: 2},
            wasser: {feuer: 2, wasser: .5, pflanze: .5, boden: 2, gestein: 2, drache: .5},
            elektro: {wasser: 2, elektro: .5, pflanze: .5, boden: 0, flug: 2, drache: .5},
            pflanze: {feuer: .5, wasser: 2, pflanze: .5, gift: .5, boden: 2, flug: .5, kaefer: .5, gestein: 2, drache: .5, stahl: .5},
            eis: {feuer: .5, wasser: .5, pflanze: 2, eis: .5, boden: 2, flug: 2, drache: 2, stahl: .5},
            kampf: {normal: 2, eis: 2, gift: .5, flug: .5, psycho: .5, kaefer: .5, gestein: 2, geist: 0, unlicht: 2, stahl: 2, fee: .5},
            gift: {pflanze: 2, gift: .5, boden: .5, gestein: .5, geist: .5, stahl: 0, fee: 2},
            boden: {feuer: 2, elektro: 2, pflanze: .5, gift: 2, flug: 0, kaefer: .5, gestein: 2, stahl: 2},
            flug: {elektro: .5, pflanze: 2, kampf: 2, kaefer: 2, gestein: .5, stahl: .5},
            psycho: {kampf: 2, gift: 2, psycho: .5, unlicht: 0, stahl: .5},
            kaefer: {feuer: .5, pflanze: 2, kampf: .5, gift: .5, flug: .5, psycho: 2, geist: .5, unlicht: 2, stahl: .5, fee: .5},
            gestein: {feuer: 2, eis: 2, kampf: .5, boden: .5, flug: 2, kaefer: 2, stahl: .5},
            geist: {normal: 0, psycho: 2, geist: 2, unlicht: .5},
            drache: {drache: 2, stahl: .5, fee: 0},
            stahl: {feuer: .5, wasser: .5, elektro: .5, eis: 2, gestein: 2, stahl: .5, fee: 2},
            unlicht: {kampf: .5, psycho: 2, geist: 2, unlicht: .5, fee: .5},
            fee: {feuer: .5, kampf: 2, gift: .5, drache: 2, unlicht: 2, stahl: .5}
        };

        let currentAtk = null;
        let currentTarget = [];
        let currentDefTeam = [];

        function init() {
            const ap = document.getElementById('atkPicker');
            const tp = document.getElementById('targetPicker');
            const dp = document.getElementById('defPicker');

            types.forEach(t => {
                // Angriff Picker
                const a = document.createElement('div');
                a.className = `icon ${t}`; a.innerHTML = labels[t];
                a.onclick = () => { currentAtk = t; update(); };
                ap.appendChild(a);

                // Ziel Picker (f√ºr Matchup)
                const target = document.createElement('div');
                target.className = `icon ${t}`; target.innerHTML = labels[t];
                target.onclick = () => {
                    if(currentTarget.includes(t)) currentTarget = currentTarget.filter(x => x !== t);
                    else { if(currentTarget.length >= 2) currentTarget.shift(); currentTarget.push(t); }
                    update();
                };
                tp.appendChild(target);

                // Verteidigungs Picker (f√ºr Team Analyse)
                const d = document.createElement('div');
                d.className = `icon ${t}`; d.innerHTML = labels[t];
                d.onclick = () => {
                    if(currentDefTeam.includes(t)) currentDefTeam = currentDefTeam.filter(x => x !== t);
                    else { if(currentDefTeam.length >= 2) currentDefTeam.shift(); currentDefTeam.push(t); }
                    update();
                };
                dp.appendChild(d);
            });
            update();
        }

        function setMode(m) {
            document.getElementById('view-attack').classList.toggle('hidden', m !== 'attack');
            document.getElementById('view-defense').classList.toggle('hidden', m !== 'defense');
            document.getElementById('btn-atk').classList.toggle('active', m === 'attack');
            document.getElementById('btn-def').classList.toggle('active', m === 'defense');
        }

        function update() {
            // Visuals Attack Mode
            document.querySelectorAll('#atkPicker .icon').forEach(i => i.classList.toggle('selected', i.classList.contains(currentAtk)));
            document.querySelectorAll('#targetPicker .icon').forEach(i => i.classList.toggle('selected', currentTarget.includes(i.classList.item(1))));
            
            // Visuals Defense Mode
            document.querySelectorAll('#defPicker .icon').forEach(i => i.classList.toggle('selected', currentDefTeam.includes(i.classList.item(1))));

            // Update Attack Stats
            const atkStats = document.getElementById('atkStats');
            if(currentAtk) {
                let html = '<div class="row"><span class="symbol">üöÄ</span>';
                types.forEach(t => { if((chart[currentAtk][t] || 1) > 1) html += `<div class="badge ${t}">${labels[t]}</div>`; });
                html += '</div><div class="row" style="margin-top:8px;"><span class="symbol">üõ°Ô∏è</span>';
                types.forEach(t => { if((chart[currentAtk][t] || 1) < 1) html += `<div class="badge ${t}">${labels[t]}</div>`; });
                atkStats.innerHTML = html + '</div>';
            } else { atkStats.innerHTML = 'W√§hle eine Attacke...'; }

            // Update Matchup Card
            const matchVs = document.getElementById('matchupVs');
            const matchVal = document.getElementById('matchupVal');
            if(currentAtk && currentTarget.length > 0) {
                let vsHtml = `<div class="badge ${currentAtk}">${labels[currentAtk]}</div> ‚öîÔ∏è `;
                currentTarget.forEach(t => vsHtml += `<div class="badge ${t}">${labels[t]}</div>`);
                matchVs.innerHTML = vsHtml;

                let total = 1;
                currentTarget.forEach(t => total *= (chart[currentAtk][t] !== undefined ? chart[currentAtk][t] : 1));
                let color = total > 1 ? '#ef4444' : total < 1 ? '#22c55e' : '#64748b';
                matchVal.innerHTML = `<div class="result-badge" style="background:${color}">${total}x Schaden</div>`;
            } else { matchVs.innerHTML = 'Attacke + Ziel w√§hlen...'; matchVal.innerHTML = ''; }

            // Update Defense Stats (Old Tab)
            const defStats = document.getElementById('defStats');
            if(currentDefTeam.length > 0) {
                let res = {};
                types.forEach(gegner => {
                    let eff = 1;
                    currentDefTeam.forEach(meinTyp => eff *= (chart[gegner][meinTyp] !== undefined ? chart[gegner][meinTyp] : 1));
                    if(eff !== 1) res[gegner] = eff;
                });
                let sorted = Object.entries(res).sort((a,b) => b[1] - a[1]);
                let html = '<div class="row">';
                sorted.forEach(([t, v]) => {
                    let l = v === 0.5 ? '¬Ω' : v === 0.25 ? '¬º' : v;
                    html += `<div class="badge ${t}">${labels[t]}<div class="mult">${l}x</div></div>`;
                });
                defStats.innerHTML = html + '</div>';
            } else { defStats.innerHTML = 'W√§hle dein Pok√©mon...'; }
        }

        init();
    </script>
</body>
</html>